



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.1.1">
    
    
      
        <title>Configuration&Setting - Smartdeskers</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.3020aac5.css">
      
        <link rel="stylesheet" href="../../assets/stylesheets/application-palette.224b79ff.css">
      
      
        
        
        <meta name="theme-color" content="#009688">
      
    
    
      <script src="../../assets/javascripts/modernizr.01ccdecf.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Ubuntu:300,400,400i,700|Ubuntu+Mono">
        <style>body,input{font-family:"Ubuntu","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Ubuntu Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../assets/fonts/material-icons.css">
    
    
    
      
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="teal" data-md-color-accent="teal">
  
    <svg class="md-svg">
      <defs>
        
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#configurationsetting" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../.." title="Smartdeskers" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              Smartdeskers
            </span>
            <span class="md-header-nav__topic">
              Configuration&Setting
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../.." title="Smartdeskers" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    Smartdeskers
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2" checked>
    
    <label class="md-nav__link" for="nav-2">
      AlphaDev
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        AlphaDev
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../Trigger/" title="Trigger" class="md-nav__link">
      Trigger
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../UserManual/" title="User Manual" class="md-nav__link">
      User Manual
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Configuration&Setting
      </label>
    
    <a href="./" title="Configuration&Setting" class="md-nav__link md-nav__link--active">
      Configuration&Setting
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#configuration-setting-overview" title="Configuration &amp; Setting Overview" class="md-nav__link">
    Configuration &amp; Setting Overview
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#improvement" title="Improvement" class="md-nav__link">
    Improvement
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#copying-the-database" title="Copying the Database" class="md-nav__link">
    Copying the Database
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#setting-up-replication" title="Setting up Replication" class="md-nav__link">
    Setting up Replication
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fixing-the-components" title="Fixing the Components" class="md-nav__link">
    Fixing the Components
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../repairlogbin/" title="Repair Log Bin" class="md-nav__link">
      Repair Log Bin
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#configuration-setting-overview" title="Configuration &amp; Setting Overview" class="md-nav__link">
    Configuration &amp; Setting Overview
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#improvement" title="Improvement" class="md-nav__link">
    Improvement
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#copying-the-database" title="Copying the Database" class="md-nav__link">
    Copying the Database
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#setting-up-replication" title="Setting up Replication" class="md-nav__link">
    Setting up Replication
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fixing-the-components" title="Fixing the Components" class="md-nav__link">
    Fixing the Components
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="configurationsetting">Configuration&amp;Setting</h1>
<h3 id="configuration-setting-overview">Configuration &amp; Setting Overview</h3>
<p>Firstly, copied MariaDB database from Raspberry  Pi to windows server MariaDB. Secondly, we copied views, functions and procedure to copied database. Third, updated our views in LCCI_DB to refer copied database. </p>
<p>After tables, views, functions and procedures completed, we test run procedure. As it finished, Check lcci_zoneocc and lcci_zonedailyprofile has been generated successfully.  </p>
<p>Fixing alpha components is the next we took, mostly it was connection string changes; for example change database name from om_main to om_2101. Other changed is some fields name; we found some fieldname change for example  Node_ID1 to Node_ID , LastUpdate1 to LastUpdate.  </p>
<p>After everything seems good, we went to setup replication in windows server MariaDB. Firstly we have to give unique server_id then put MariaDB Master detail to configuration file in this case my.ini file. You might need to restart MariaDB. Check if Slave process started ; Lastly, if the data has been replicated successfully. The last step when replication running we change live data connection string to Windows Server. </p>
<h3 id="improvement">Improvement</h3>
<ul>
<li>current occupancy status </li>
<li>current zone temperature, and  </li>
<li>systems status getting from data from windows server, it reduce Rasbery Pi call for big amount for live data. </li>
<li>Live data seems pretty fast as it get data from windows server </li>
<li>When rasberry pi offline due to WIFI dongle issue system status and other live data still looks fine, before when rasberry pi goes offline users will get loads longer before it throw red errors like : can't connect 10.8.0.42; now it still display data even if it is not latest data </li>
<li>Procedure still required scheduled start at 3:00 AM. It takes around 2 hours, check lcci_zoneocc and lcci_zonedailyprofile. Do not stop the process call lcci_doAll when you test it manually or there will be duplicate procedure running. You can check by run: show processlist; normally 1 line saying query updating lcci_zonedailyprofile </li>
</ul>
<p>Demo 
<a href="http://smartdesk.ddns.net/tim/admin.a5w">Smartdesk LCCI UK</a></p>
<hr />
<h3 id="copying-the-database">Copying the Database</h3>
<ol>
<li>Copy MDBbu.sql.tar.gz 
\10.8.0.42\mariadbbackup </li>
<li>Create database Om_2101 </li>
<li>Restore database from dump file (it takes longer please wait)
<div class="highlight"><pre><span></span>mysql.exe -uroot -pseaford -hlocalhost OM_2101 &lt; C:\easy-pc\files\home\occmon\Mariadb\data_backup\MDBbu.sql
</pre></div></li>
<li>Copy view to create chart to  OM_2101 </li>
<li>Edit view in LCCI_DB; change referenced database to OM_OM_2101 </li>
<li>Copy procedure and function to do create tables lcci_zoneocc and lcci_zonedailyprofile </li>
<li>Check procedure by running  call LCCI_DoAll </li>
<li>Check if procedure success </li>
<li>Make sure no query update running, that  one indicator procedure has been finished, 
<div class="highlight"><pre><span></span><span class="k">show</span> <span class="n">processlist</span><span class="p">;</span> 
</pre></div></li>
<li>Check these table  lcci_zoneocc and lcci_zonedailyprofile has current date </li>
</ol>
<hr />
<h3 id="setting-up-replication">Setting up Replication</h3>
<ol>
<li>
<p>Go to server MariaDB </p>
</li>
<li>
<p>Edit my.ini </p>
</li>
<li>
<p>Add unique server_id </p>
</li>
<li>
<p>Save Configuration </p>
</li>
<li>
<p>Restart MariaDB on Windows Server  </p>
</li>
<li>
<p>Add detail MariaDB of Raspberry Pi as Master </p>
</li>
</ol>
<p>change master to</p>
<p><div class="highlight"><pre><span></span><span class="n">MASTER_HOST</span><span class="o">=</span><span class="err">’</span><span class="mi">10</span><span class="p">.</span><span class="mi">8</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">42</span><span class="err">’</span><span class="p">,</span> 

<span class="n">MASTER_USER</span><span class="o">=</span><span class="s1">&#39;omrepuser&#39;</span><span class="p">,</span> 

<span class="n">MASTER_PASSWORD</span><span class="o">=</span><span class="s1">&#39;OCCupancy&#39;</span><span class="p">,</span> 

<span class="n">MASTER_PORT</span><span class="o">=</span><span class="mi">3306</span><span class="p">,</span> 

<span class="n">MASTER_LOG_FILE</span><span class="o">=</span> <span class="err">‘</span><span class="n">mysqld</span><span class="o">-</span><span class="n">bin</span><span class="p">.</span><span class="mi">000006</span><span class="err">’</span><span class="p">,</span> 

<span class="n">MASTER_LOG_POS</span><span class="o">=</span><span class="mi">328</span><span class="p">,</span> 

<span class="n">MASTER_CONNECT_RETRY</span><span class="o">=</span><span class="mi">10</span><span class="p">;</span> 
</pre></div>
7. Check if replication has been running 
Run command  to start replication 
<div class="highlight"><pre><span></span><span class="n">START</span> <span class="n">SLAVE</span><span class="p">;</span> 
</pre></div>
8. Run to check if replication running 
<div class="highlight"><pre><span></span><span class="k">SHOW</span> <span class="n">SLAVE</span> <span class="n">STATUS</span> <span class="err">\</span><span class="n">G</span> <span class="p">;</span> 
</pre></div></p>
<blockquote>
<p><img alt="📝" class="emojione" src="https://cdn.jsdelivr.net/emojione/assets/svg/1f4dd.svg" title=":memo:" />
Make sure that:<br>
Slave_IO_Running: Yes <br>
Slave_SQL_Running: Yes <br></p>
</blockquote>
<hr />
<blockquote>
<p><img alt="💡" class="emojione" src="https://cdn.jsdelivr.net/emojione/assets/svg/1f4a1.svg" title=":bulb:" /> Check in the table OM_events: <br>
1. Compare OM_events in Raspberry Pi and Windows Server, <br>
2. check the DateTime field , if success you will see exact same records between Rasberry Pi and Windows Server MariaDB. <br>
3. Don't forget to refresh your navicat for both table at the same time so the record will be exactly the same. <br></p>
</blockquote>
<h2 id="_1"><img alt="Screenshot" src="../../img/cs1.png" /></h2>
<h3 id="fixing-the-components">Fixing the Components</h3>
<ol>
<li>
<p>Edit connection string in Alpha Five </p>
</li>
<li>
<p>Change field name refer to new database; eg. Node_ID1 to Node_ID , LastUpdate1 to LastUpdate </p>
</li>
<li>
<p>Publish server to development server </p>
</li>
<li>
<p>Deploy to Production Server <a href="http://smartdesk.ddns.net/tim/admin.a5w">http://smartdesk.ddns.net/tim/admin.a5w</a> </p>
</li>
<li>
<p>Check components display as expected </p>
</li>
</ol>
<p>For Mobile 
We do the same as desktop components mostly changing connection string to copied database (om_2101) </p>
<hr />
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../UserManual/" title="User Manual" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                User Manual
              </span>
            </div>
          </a>
        
        
          <a href="../repairlogbin/" title="Repair Log Bin" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Repair Log Bin
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.dc02f8ce.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:"../.."}})</script>
      
    
  </body>
</html>